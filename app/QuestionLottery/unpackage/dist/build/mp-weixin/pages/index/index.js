(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"636b":function(e,t,o){"use strict";o.r(t);var n=o("c0d6"),i=o.n(n);for(var s in n)"default"!==s&&function(e){o.d(t,e,(function(){return n[e]}))}(s);t["default"]=i.a},"79bb":function(e,t,o){"use strict";(function(e){o("a49a");n(o("66fd"));var t=n(o("e42f"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o("543d")["createPage"])},"8c50":function(e,t,o){"use strict";var n=o("c6a7"),i=o.n(n);i.a},c0d6:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{modalName:null,canGetPrize:!0,openid:"",user_nickname:"",user_phone:"",user_info:null,apartmentId:"",shouldShowContent:!1,showCenterIcon:!0,isActivityStart:!1,isMember:!1,memberMsg:"",startMsg:"",isLogin:!1,hint:"登录后可以完整使用服务。首次使用，需要授权获取您的手机号进行登录绑定。"}},onLoad:function(t){console.log("======二维码解析参数========"),console.log(t.q);var o=decodeURIComponent(t.q),n=o.split("/"),i=n[n.length-1];this.apartmentId=i,e.setStorageSync(getApp().globalData.key_apart,this.apartmentId)},onShow:function(){var t=this;this.user_phone=e.getStorageSync(getApp().globalData.key_phone_num),this.openid=e.getStorageSync(getApp().globalData.key_wx_openid),e.login({provider:"weixin",success:function(o){console.log("+++code："+o.code),e.showLoading({title:"正在查询中..."}),t.requestWithMethod(getApp().globalData.api_login+o.code,"POST","",t.successCb,t.failCb,t.completeCb)}}),e.showLoading({title:"正在查询中..."}),this.requestWithMethod(getApp().globalData.is_in_activity_time,"GET","",this.successInActCb,this.failInActCb,this.completeInActCb)},methods:{showAlreadyLottery:function(){e.showToast({icon:"none",title:"您已经抽奖，不能再次参与活动"})},onStart:function(){if("undefined"===this.apartmentId)e.showToast({icon:"none",title:"请扫码参与活动"});else if(this.canGetPrize){e.showLoading({title:"正在查询中..."});var t={phone_number:e.getStorageSync(getApp().globalData.key_phone_num)};this.requestWithMethod(getApp().globalData.is_member,"POST",t,this.successIsMemberCb,this.failIsMemberCb,this.completeIsMemberCb)}else this.showAlreadyLottery()},onRank:function(){e.navigateTo({url:"../rank/rank"})},onRule:function(){e.navigateTo({url:"../rule/rule"})},onRecord:function(){e.navigateTo({url:"../receive_history/receive_history"})},onWarmup:function(){e.navigateTo({url:"../warmup/warmup"})},showPhoneModal:function(e){this.modalName=e},hideModal:function(e){this.modalName=null},successIsMemberCb:function(t){console.log("is_member success"),console.log(t),e.hideLoading(),this.isMember=t.data.is_member,this.memberMsg=t.data.msg,this.canGetPrize=t.data.can_get_prize,console.log("can_get_prize:"+this.canGetPrize),e.setStorageSync(getApp().globalData.key_can_get_prize,this.canGetPrize),this.isMember?e.navigateTo({url:"../../receive_info_check/receive_info_check"}):e.showToast({title:this.memberMsg})},failIsMemberCb:function(t){console.log("is_member failed",t),e.hideLoading()},completeIsMemberCb:function(e){},successInActCb:function(t){console.log("is_in_activity_time success"),console.log(t),console.log(t.statusCode+"mmmk"),e.hideLoading(),this.isActivityStart=t.data.is_start,this.startMsg=t.data.msg},failInActCb:function(t){console.log("is_in_activity_time failed",t),e.hideLoading()},completeInActCb:function(e){},successCb:function(t){if(console.log("weixin_sns success"),console.log(t),0===t.data.error){this.openid=t.data.openid;var o=t.data.is_login;e.setStorageSync(getApp().globalData.key_wx_openid,t.data.openid),console.log("is_login:"+o),0==o?this.showPhoneModal("PhoneModal"):(e.showLoading({title:"登录中.......",mask:!0}),this.requestUserInfo())}},failCb:function(t){console.log("api_login failed",t),e.hideLoading()},completeCb:function(e){},successGetUserInfoCb:function(t){if(e.hideLoading(),console.log(t),0===t.data.error){this.user_info=t.data.msg.user_info,console.log(this.user_info);var o=this.user_info[0].user_name;console.log("user_name===="+o),e.setStorageSync(getApp().globalData.key_user_name,o),this.isEmpty(o)?e.navigateTo({url:"./user_info"}):(e.setStorageSync(getApp().globalData.key_user_name,this.user_info[0].user_name),e.setStorageSync(getApp().globalData.key_phone_num,this.user_info[0].phone_number),e.hideLoading(),this.shouldShowContent=!0)}},failGetUserInfoCb:function(t){e.hideLoading(),console.log("get_user_info failed",t)},completeGetUserInfoCb:function(e){},requestUserInfo:function(){this.requestWithMethod(getApp().globalData.get_user_info+this.openid,"GET","",this.successGetUserInfoCb,this.failGetUserInfoCb,this.completeGetUserInfoCb)},successPhoneCb:function(t){console.log("weixin_gusi success, rsp======"),console.log(t),this.showCenterIcon=!1,this.containsStr(t.errMsg,"ok")&&(e.setStorageSync(getApp().globalData.key_phone_num,t.data.purePhoneNumber),e.hideLoading(),this.requestUserInfo()),"1"===t.data.is_exist||e.getStorageSync("key_key_is_update")||e.navigateTo({url:"../login/register"})},failPhoneCb:function(e){console.log("weixin_gusi failed",e)},completePhoneCb:function(e){},getPhoneNumber:function(t){this.hideModal();if("getPhoneNumber:fail user deny"==t.detail.errMsg)e.showModal({title:"提示",showCancel:!1,content:"未授权将无法登录",success:function(e){}});else{e.showLoading({title:"跳转中"});var o={encryptedData:t.detail.encryptedData,iv:t.detail.iv,openid:this.openid};this.requestWithMethod(getApp().globalData.api_getWXInfo,"POST",o,this.successPhoneCb,this.failPhoneCb,this.completePhoneCb)}}}};t.default=o}).call(this,o("543d")["default"])},c6a7:function(e,t,o){},e42f:function(e,t,o){"use strict";o.r(t);var n=o("eb4b"),i=o("636b");for(var s in i)"default"!==s&&function(e){o.d(t,e,(function(){return i[e]}))}(s);o("8c50");var a,c=o("f0c5"),r=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=r.exports},eb4b:function(e,t,o){"use strict";var n;o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return s})),o.d(t,"a",(function(){return n}));var i=function(){var e=this,t=e.$createElement;e._self._c},s=[]}},[["79bb","common/runtime","common/vendor"]]]);